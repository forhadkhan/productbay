# Development Guide

This document contains detailed information about the project structure, development workflows, and architectural decisions used in ProductBay.


### Setup Instructions

1. **Clone the Repository**
   Navigate to your WordPress plugins directory:
   ```bash
   cd wp-content/plugins
   git clone https://github.com/forhadakhan/productbay.git
   cd productbay
   ```

2. **Install Dependencies**
   ```bash
   bun install
   ```

3. **Start Development Server**
   This command checks/starts local Web & DB services, then starts the Bun-powered build process.
   ```bash
   bun run dev
   ```
   *(Automatically uses `dev.ps1` for Windows and `dev.sh` for Linux/macOS)*
   *The React app will hot-reload, and CSS changes will compile instantly.*

4. **Build for Production**
   Before deploying, run the build command to minify and optimize assets.
   ```bash
   bun run build
   ```

5. **Run lints**
   ```bash
   bun run lint
   ```
   or
   ```bash
   bun run lint:php
   ``` 
   or
   ```bash
   bun run lint:css
   ``` 
   etc. 

   bun run release

   # for versioned zip
   bun run release -- --versioned
   ``` 

7. **i18n (Translations)**  
   After writing translatable strings, build to extract them:
   
   bun run build
   ```
   Convert `.po` files to JSON for React (requires WP-CLI):
   ```bash
   bun i18n:make-json
   ```
   See [notes/TRANSLATIONS.md](./notes/TRANSLATIONS.md) for complete workflow.

8. **More**  
   Format code:
   ```bash
   bun run format
   ```
   Check Engines:
   ```bash
   bun run check-engines
   ```
   Check Licenses:
   ```bash
   bun run check-licenses
   ```
   

## üìÇ Project Structure

The project follows a strict separation of concerns, ensuring maintainability and scalability.

```text
productbay/
‚îú‚îÄ‚îÄ app/                        # PHP Application Logic (The "Brain")
‚îÇ   ‚îú‚îÄ‚îÄ Admin/                  # Admin-specific logic (Menu registration, Asset enqueuing)
‚îÇ   ‚îú‚îÄ‚îÄ Api/                    # REST API Controllers (Handle React frontend requests)
‚îÇ   ‚îú‚îÄ‚îÄ Core/                   # Core infrastructure (Plugin init, DI Container, Router)
‚îÇ   ‚îú‚îÄ‚îÄ Data/                   # Data Access Layer (Repositories, Models)
‚îÇ   ‚îú‚îÄ‚îÄ Frontend/               # Public-facing logic (Shortcodes, AJAX handlers)
‚îÇ   ‚îî‚îÄ‚îÄ Http/                   # Request/Response helpers
‚îú‚îÄ‚îÄ assets/                     # Compiled Public Assets (Generated by build process)
‚îÇ   ‚îú‚îÄ‚îÄ css/                    # Compiled Tailwind CSS
‚îÇ   ‚îú‚îÄ‚îÄ js/                     # Compiled React & Frontend JS bundles
‚îú‚îÄ‚îÄ dist/                       # Release Staging Area (Generated by release script)
‚îú‚îÄ‚îÄ languages/                  # Translation Files (.pot, .po, .mo)
‚îú‚îÄ‚îÄ node_modules/               # NPM Dependencies (Git ignored)
‚îú‚îÄ‚îÄ notes/                      # Developer Notes & Documentation
‚îú‚îÄ‚îÄ scripts/                    # Build & Maintenance Scripts
‚îú‚îÄ‚îÄ src/                        # Source Code (The "Face")
‚îÇ   ‚îú‚îÄ‚îÄ components/             # Reusable React Components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # Reusable UI Primitives (Buttons, Modals, Inputs)
‚îÇ   ‚îú‚îÄ‚îÄ layouts/                # Admin Layouts (Sidebar, Header wrappers)
‚îÇ   ‚îú‚îÄ‚îÄ pages/                  # Main Admin Views (Dashboard, Table Editor, Settings)
‚îÇ   ‚îú‚îÄ‚îÄ store/                  # Zustand State Management
‚îÇ   ‚îú‚îÄ‚îÄ styles/                 # Raw CSS & Tailwind Directives
‚îÇ   ‚îú‚îÄ‚îÄ types/                  # TypeScript Interfaces & Types
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # JS Helper functions & API Clients
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                 # Main React App Entry
‚îÇ   ‚îî‚îÄ‚îÄ index.tsx               # Entry point mounting the React App to DOM
‚îú‚îÄ‚îÄ vendor/                     # PHP Dependencies (Composer)
‚îú‚îÄ‚îÄ composer.json               # PHP Dependencies & Scripts
‚îú‚îÄ‚îÄ package.json                # JS Dependencies & Scripts
‚îú‚îÄ‚îÄ phpcs.xml.dist              # PHPCS (PHP Code Sniffer) ruleset for ProductBay
‚îú‚îÄ‚îÄ productbay.php              # Main Plugin File (Bootstrapper)
‚îú‚îÄ‚îÄ readme.txt                  # WordPress Plugin Directory Readme
‚îú‚îÄ‚îÄ tailwind.config.js          # Tailwind CSS Configuration
‚îú‚îÄ‚îÄ tsconfig.json               # TypeScript Configuration
‚îú‚îÄ‚îÄ uninstall.php               # On plugin delete, clean up all plugin-related data from the database 
‚îî‚îÄ‚îÄ webpack.config.js           # Webpack Build Configuration
```

## üìñ How It Works

1. **Initialization:** [productbay.php](../productbay.php) bootstraps the [Plugin](../app/Core/Plugin.php) class in `app/Core`.
2. **Admin Load:** The [Admin](../app/Admin/Admin.php) class enqueues `assets/js/admin.js` on the specific plugin page.
3. **React Mount:** [src/index.tsx](../src/index.tsx) finds the `#productbay-root` div and mounts the React App.
4. **Data Fetching:** The React app sends authenticated requests to `app/Api/` endpoints via the WP REST API.
5. **Frontend Rendering:** Using the `[productbay id="123"]` shortcode, the PHP backend renders the initial view, and `assets/js/frontend.js` takes over for interactive elements.


## üì¶ State Management

We use **Zustand** for global state management in the React admin application. It provides a lightweight, scalable alternative to Redux or React Context.

### usage
The global store is located at `src/store/useStore.ts`. It follows a standard hook-based pattern:

```typescript
import { useStore } from './store/useStore';

const MyComponent = () => {
    const { count, increment } = useStore();
    return <button onClick={increment}>{count}</button>;
};
```

### Pattern
- **Centralized Store**: Prefer a single, well-organized store in `useStore.ts` for most application data.
- **Slicing (Future)**: If the state grows significantly, we will migrate to a sliced store pattern to maintain readability.
- **Actions**: Define actions (updaters) within the store itself to keep state logic centralized.


## üé® Tailwind CSS Architecture & Best Practices

Uses **Tailwind CSS v4** for styling the React-based admin interface. Since WordPress plugins exist in a shared environment (the WP Admin dashboard), precautions are taken to prevent styles from conflicting with other plugins or the WordPress core UI.

### 1. Scoped Styling (Isolation)

To adhere to WordPress.org best practices regarding CSS conflicts, the project does **not** rely on prefixing every single utility class. Instead, it uses a robust **scoping strategy**:

-   **The Mechanism**: In [tailwind.config.js](../tailwind.config.js), we set `important: '#productbay-root'`.
-   **The Result**: All generated Tailwind utilities are automatically prefixed with an ID selector (e.g., `#productbay-root .text-center`).
-   **Benefit**: This ensures our styles **strictly** apply only to elements inside our React application wrapper (`<div id="productbay-root">`). We can use standard Tailwind classes like `p-4` or `flex` without fear of affecting the global WordPress admin interface.

### 2. Disabling Preflight

Standard Tailwind includes a "Preflight" (reset) set of styles that normalizes HTML elements globally (e.g., removing margins from headers, making images block-level).

-   **Problem**: If included, this global reset would "leak" out of the plugin and break the layout of the WordPress Admin bar, menu, and other pages.
-   **Solution**: Disabled the default preflight in the configuration.
-   **Scoped Reset**: To ensure the app still looks correct, a *scoped* reset is manually added in [src/styles/main.css](../src/styles/main.css) that only targets `#productbay-root`.


### 3. Compliance with WordPress.org Guidelines

This approach is fully compliant with the WordPress Plugin Review Team's guidelines (2024-2025 standards).

-   **Guideline**: "Plugins must prefix all functions, classes, and global variables to avoid conflicts."
-   **CSS Interpretation**: CSS selectors must be unique enough to avoid collisions.
-   **Implementation**: By namespacing all CSS under the unique ID `#productbay-root`, the requirement for uniqueness and conflict prevention is satisfied, essentially "prefixing" every rule at the selector level.

This strategy offers the best of both worlds: a modern, utility-first developer experience and a polite, isolated footprint within the WordPress ecosystem.

## üêò PHP Naming Conventions & Best Practices

To avoid conflicts with other plugins and WordPress core, we adhere to the following strict naming conventions.

### 1. Classes: Use Namespaces (Not Prefixes)
**PSR-4** autoloading standards are followed.
-   **Bad (Old Way)**: `class ProductBay_Admin_Menu { ... }`
-   **Good (Current Way)**: `namespace ProductBay\Admin; class Menu { ... }`

**Why?** Namespaces provide cleaner code, better organization, and improved autoloading support via Composer or our custom SPL autoloader. It naturally isolates our code from the global class scope.

### 2. Global Constants
All global constants **must** be prefixed with `PRODUCTBAY_`.
-   **Example**: `PRODUCTBAY_VERSION`, `PRODUCTBAY_PATH`.

### 3. Global Functions
Avoid global functions whenever possible.
-   If necessary (e.g., for template tags), prefix with `productbay_`.
-   Prefer static methods in namespaced classes: `ProductBay\Utils\Helper::do_something()`.

## üõ†Ô∏è Tooling & Linting

Modern tooling is used to ensure code quality.

### Autoloading
**Composer** is used for PSR-4 autoloading.
-   Run `composer install` to verify dependencies.
-   Namespace root: `ProductBay\` -> `app/`.

### Linting Commands
Run these commands to verify your code:
-   **PHP**: `bun run lint:php` (or `composer run-script lint` if defined) - Checks WordPress Coding Standards.
-   **JS/TS**: `bun run lint:js` - Checks eslint rules.
-   **CSS**: `bun run lint:css` - Checks stylelint rules.

### Versioning & Metadata
Always keep metadata consistent across:
1.  `productbay.php` (Plugin Header)
2.  `composer.json`
3.  `package.json`

---

## üåê Internationalization (i18n)

ProductBay supports translations for both PHP and React. See complete documentation:
- **[TRANSLATIONS.md](./TRANSLATIONS.md)** - Full translation workflow and examples


